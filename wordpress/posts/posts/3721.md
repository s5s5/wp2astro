---
id: 3721
title: "WordPress 使用 v2ray 代理"
date: 2017-12-11T09:33:37.000Z
categories:
  - "first-category"
---

WordPress 有很多播件要连接 Wordpress.com、Google、Facebook、Twitter 等这些网站，但因为某些你懂的原因连不上，导致插件功能无法使用，所在 WordPress 所在的服务器要通过代理才可以访问才可以。以前有人总结方法是在服务器上安装 酸酸 连上代理服务器建立 SOCKS 代理，然后然后再装个 Polipo 把 SOCKS 代理转为 HTTP 代理。为什么要转为 HTTP 代理，因为 WordPress 只支持设置 HTTP 代理……

刚好最近有看 [v2ray](https://www.v2ray.com) 的介绍，他即可以做出口代理可以做入口代理，非常方便。更是在传出传入可选择多种协议，那么我们可以只安装一个 v2ray ，就能建立传入协议用 HTTP ，传出协议用 VMess 的代理（VMess 是 v2ray 搞出来的协议，如同酸酸）。首先，您得有台海外服务器，比如 [搬瓦工](https://bwh1.net/aff.php?aff=22177) 。

在海外服务器安装 v2ray ，注意以下自动安装脚本只支持 CentOS 7 64位或带有 Systemd 的系统，以及 Debian / Ubuntu 全系列。还要先安装好 unzip 和 daemon 。

```
bash <(curl -L -s https://install.direct/go.sh)
```

安装完成，已经配置好一个传入协议是 VMess 的配置文件在 `/etc/v2ray/config.json` ，查看这个文件，记录 端口 和 uuid （形如：c503b067-e78f-b037-1ac7-7b369103ec9f）<!--more-->

然后在 WordPress 所在服务器安装 v2ray （好吧，你的服务器也得是个 CentOS 7 64位或带有 Systemd 的系统），然后修改 `/etc/v2ray/config.json` 文件为以下内容，注意把刚才记录的内容改到我加中文的地方。修改后重启服务器（懒得写只重启 v2ray 的命令了）。

```
{
    "log": {
        "loglevel": "warning"
    },
    "inbound": {
        "listen": "127.0.0.1",
        "port": 8080,
        "protocol": "http",
        "settings": {
            "allowTransparent": false,
            "userLevel": 1
        }
    },
    "outbound": {
        "protocol": "vmess",
        "settings": {
            "vnext": [
                {
                    "address": "168.168.168.168这里改成代理网站IP",
                    "port": 8888这里改成代理网站端口,
                    "users": [
                        {
                            "id": "c503b067-e78f-b037-1ac7-7b369103ec9f这里改成代理网站的uuid",
                            "level": 1,
                            "alterId": 64
                        }
                    ]
                }
            ]
        }
    },
    "outboundDetour": [
        {
            "protocol": "freedom",
            "settings": {},
            "tag": "direct"
        }
    ],
    "routing": {
        "strategy": "rules",
        "settings": {
            "rules": [
                {
                    "type": "field",
                    "port": "54-79",
                    "outboundTag": "direct"
                },
                {
                    "type": "field",
                    "port": "81-442",
                    "outboundTag": "direct"
                },
                {
                    "type": "field",
                    "port": "444-65535",
                    "outboundTag": "direct"
                },
                {
                    "type": "field",
                    "domain": [
                        "gc.kis.scr.kaspersky-labs.com"
                    ],
                    "outboundTag": "direct"
                },
                {
                    "type": "chinasites",
                    "outboundTag": "direct"
                },
                {
                    "type": "field",
                    "ip": [
                        "0.0.0.0/8",
                        "10.0.0.0/8",
                        "100.64.0.0/10",
                        "127.0.0.0/8",
                        "169.254.0.0/16",
                        "172.16.0.0/12",
                        "192.0.0.0/24",
                        "192.0.2.0/24",
                        "192.168.0.0/16",
                        "198.18.0.0/15",
                        "198.51.100.0/24",
                        "203.0.113.0/24",
                        "::1/128",
                        "fc00::/7",
                        "fe80::/10"
                    ],
                    "outboundTag": "direct"
                },
                {
                    "type": "chinaip",
                    "outboundTag": "direct"
                }
            ]
        }
    }
}
```

这样就建立了一个 127.0.0.1：8080 的 HTTP 代理（其它要代理的也可以用它）

最后修改 WordPress 的 `wp-config.php` 文件，添加：

```
/** 代理 */
define('WP_PROXY_HOST', '127.0.0.1');
define('WP_PROXY_PORT', '8080');
define('WP_PROXY_BYPASS_HOSTS', 'localhost, s5s5.me, *.wordpress.org, *.baidu.com, *.qq.com');
```

好了，试试你那些以前不好用的插件吧，比如：Jetpack。

还有，其实海外服务器可以不装 v2ray ，只装 酸酸 ，在 WordPress 装的 v2ray 传入协议用 酸酸 相关配置就可以连上哦，v2ray 真强大也！
